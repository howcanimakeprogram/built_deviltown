# 글로벌 룰 (유지보수/보안/문서화/설명 강화 버전)

==============================
[코드 구조 / 리팩토링]
==============================
1) 단일 책임 원칙(SRP): 함수/클래스/파일은 한 가지 책임만 가진다.
2) 계층 분리: UI / 비즈니스 로직 / 데이터 접근 / 외부연동(API, Playwright, Sheets)은 반드시 분리한다.
3) 중복 금지(DRY): 동일 로직이 2회 이상 나오면 공통 함수/모듈로 추출한다.
4) 긴 함수 금지: 함수가 30줄(또는 중첩 3단) 넘으면 리팩토링을 제안하고 분해한다.
5) 하드코딩 금지: URL, Sheet명, 셀 범위, selector, magic number는 상수/설정(config)으로 분리한다.

==============================
[예외처리 / 주석 / 문서화]
==============================
6) 외부 I/O 필수 예외처리: 네트워크/파일/DB/Google API/Playwright 동작은 try-except로 감싸고 실패 시 처리 경로를 명확히 한다.
7) 예외 메시지 표준화: 예외 발생 시 "무엇을 하다/왜 실패했는지/다음 행동"이 드러나게 오류 메시지를 작성한다.
8) 주석 필수 기준:
   - WHY(왜 필요한지) 설명 주석을 우선한다. (무엇/어떻게는 코드로 표현)
   - 복잡한 로직, 비즈니스 규칙, 우회처리(workaround), selector 근거, API 제한사항은 반드시 주석으로 설명한다.
9) 함수/모듈 설명 의무:
   - 공개 함수/서비스는 docstring 또는 헤더 주석으로 "목적/입력/출력/부작용(외부 호출)/예외"를 설명한다.
10) 인수인계 가독성 규칙:
   - 파일 상단에 "이 파일의 역할 / 호출 관계 / 수정 시 주의사항"을 3~8줄로 요약한다.
   - 함수명은 동작이 명확히 드러나게 작성한다(모호한 이름 금지).
   - 구조 파악이 어려운 부분은 주석 보강 또는 리팩토링 제안한다.

==============================
[로그 관리 / 관측성]
==============================
11) print 금지: 운영/자동화 코드에서 print() 사용 금지. logging(또는 GAS Logger/console)로 통일한다.
12) 로그 레벨 규칙:
   - info: 정상 흐름의 주요 단계
   - warning: 복구 가능/데이터 이상 징후
   - error: 작업 실패(재시도/중단 포함)
   - debug: 문제 해결용 상세(기본 비활성)
13) 민감정보 로그 금지:
   - 토큰/비번/쿠키/세션/주민번호/전화/메일 등은 로그에 절대 남기지 말고 마스킹한다.

==============================
[로깅 포맷 표준]
==============================
14) 모든 작업은 고유 작업ID(job_id)를 생성한다.
15) 로그에는 반드시 아래 정보를 포함한다:
   - job_id
   - 예약번호/주요 식별자
   - 단계명(step)
   - 처리 건수(count)
   - 소요 시간(duration_ms)
   - 결과(status: success/fail)
   - 오류 메시지(error_message, 존재 시)
16) 로그 포맷 예시:
   - [INFO]  job_id=20260215-001 booking=R12345 step=fetch_data  count=12 duration_ms=842  status=success
   - [ERROR] job_id=20260215-001 booking=R12345 step=update_sheet duration_ms=120 status=fail error="Google API quota exceeded"
17) 시작/종료 로그는 반드시 남긴다.

==============================
[테스트 / 임시 데이터 정리]
==============================
18) 테스트 목적의 임시 파일/더미 데이터/다운로드 파일/스크린샷/리포트는 테스트 완료 후 삭제한다.
19) 단, "테스트 수행 기록"은 로그로 남겨도 된다.
20) 테스트 데이터는 운영 데이터와 혼합되지 않도록 분리한다(폴더/시트/계정 분리 권장).

==============================
[버전 관리 / 변경 추적]
==============================
21) 버전 관리 필수:
   - 의미 있는 커밋 단위로 커밋하고 커밋 메시지는 변경 이유가 드러나게 작성한다.
22) 변경 로그(Changelog) 권장:
   - 자동화 로직/시트 스키마/selector 변경은 CHANGELOG 또는 릴리즈 노트로 기록한다.
23) 파괴적 변경 금지:
   - 스키마/컬럼/시트 구조 변경 시 이전 버전과의 호환 또는 마이그레이션 안내를 포함한다.

==============================
[보안 / API / 암호화]
==============================
24) 비밀정보 저장 금지:
   - API Key, 서비스계정 JSON, 토큰, 비밀번호를 코드에 직접 넣지 않는다.
   - .env / OS Keychain / Secret Manager / 암호화 파일 등 안전한 저장소를 사용한다.
25) 암호화 필수:
   - 디스크에 저장되는 credential/토큰은 암호화(예: Fernet)하고 키는 환경변수 등 별도 경로로 관리한다.
26) 최소 권한 원칙:
   - Google API scope, 계정 권한, 파일 접근권한은 필요한 최소만 부여한다.
27) 보안 재점검 절차(배포/공유 전):
   - (a) 키/토큰 하드코딩 여부
   - (b) 로그 유출 여부
   - (c) 권한 과다 여부
   - (d) 디버그 모드 비활성화
   - (e) 테스트용 계정/URL 제거
   를 반드시 점검한다.

==============================
[보안 체크리스트 – 배포 전 10초 점검]
==============================
28) 코드에 하드코딩된 API key / token / password가 없는가?
29) .env 또는 Secret Manager 사용 여부 확인
30) 로그에 민감정보 출력 여부 확인
31) 최소 권한 원칙 적용 여부 (Google scope, API 권한)
32) credential 파일 암호화 여부 확인
33) 예외 메시지에 내부 시스템 정보 노출 여부 확인
34) 디버그 모드 비활성화 여부 확인
35) 테스트용 계정/URL 제거 여부 확인
36) 외부 공유 전 git diff로 민감정보 재확인
37) 사용하지 않는 라이브러리 제거 여부 확인

==============================
[유지보수 / Maintenance]
==============================
38) 유지보수 기준 문서(MAINTENANCE.md)를 포함한다.
39) MAINTENANCE.md에는 다음 내용을 포함한다:
   - 의존성 목록 및 버전
   - 환경 설정 방법 (.env 구조 설명)
   - 배포 절차
   - 롤백 방법
   - 로그 확인 방법
   - 정기 점검 항목
   - 외부 API 변경 대응 절차
40) 주요 라이브러리/외부 API 버전 변경 시 변경 영향도 분석 후 문서 업데이트.
41) 기술 부채(임시 코드, TODO)는 주석과 문서에 명시하고 추적 가능하도록 관리한다.
42) 자동화 스크립트는 최소 분기 1회 이상 동작 점검을 수행한다.

==============================
[문서 필수 작성 / 구조-프로세스 명세]
==============================
43) 프로젝트에는 반드시 다음 문서를 포함한다(프로젝트에 이미 존재하면 유지/갱신):
   - README.md (개요/실행 방법/환경 변수)
   - ARCHITECTURE.md 또는 SYSTEM_DOCS.md (구조/모듈 관계/데이터 흐름)
   - PROCESS.md 또는 RUNBOOK.md (운영 절차/장애 대응/점검)
   - CHANGELOG.md (변경 기록)
   - MAINTENANCE.md (유지보수 기준)
44) 구조 변경 시 구조 문서(ARCHITECTURE.md 또는 SYSTEM_DOCS.md) 업데이트 필수.
45) 프로세스 변경 시 PROCESS.md 또는 RUNBOOK.md 업데이트 필수.

==============================
[설명 / 구조 해석 의무]
==============================
46) 코드 생성 후 반드시 다음을 설명한다:
   - 전체 구조 요약
   - 각 파일의 역할
   - 주요 함수의 역할
   - 데이터 흐름
47) 코드 수정 시 반드시 다음을 설명한다:
   - 변경된 부분
   - 변경 이유
   - 영향 받는 모듈
48) 복잡한 로직은 코드 내부 주석 + 외부 설명을 함께 제공한다.
49) 구조 설명은 코드 내부 주석 또는 별도의 .md 파일로 작성해도 된다.
50) 요청 시 초보자 수준으로 단계별 설명을 제공한다.